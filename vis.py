import numpy as np
import time

A = np.array(
    [
        [3.31076341e-01, 9.62218123e-02, 7.25300527e-02, 8.93317624e-02],
        [3.09107962e-02, 2.11238465e-02, 1.53940941e-03, 8.15916450e-02],
        [2.30580059e-02, 1.10205893e-02, 3.05104836e-02, 5.81989088e-02],
        [1.89392072e-03, 1.42514492e-03, 3.61505851e-03, 3.33071549e-02],
        [4.10216080e-01, 7.15773401e-02, 1.85316436e-02, 8.37170734e-02],
        [0.00000000e00, 0.00000000e00, 0.00000000e00, 0.00000000e00],
        [3.27832769e-04, 4.25377235e-04, 1.36010420e-01, 5.37383451e-04],
        [0.00000000e00, 0.00000000e00, 0.00000000e00, 0.00000000e00],
        [5.36724237e-02, 1.49053850e-01, 1.32325076e-01, 5.76347785e-01],
        [1.16731702e-02, 7.47882851e-01, 5.26449538e-02, 5.56077547e-02],
        [6.90443526e-01, 7.89701771e-02, 1.79099164e-02, 7.15556071e-03],
        [0.00000000e00, 0.00000000e00, 0.00000000e00, 0.00000000e00],
        [0.00000000e00, 0.00000000e00, 0.00000000e00, 0.00000000e00],
        [1.35647619e-01, 3.20232106e-01, 8.67775997e-01, 5.98079233e-04],
        [4.08023861e-01, 9.53201064e-01, 2.40692710e-01, 3.94354541e-01],
        [0.00000000e00, 0.00000000e00, 0.00000000e00, 0.00000000e00],
    ]
)

COLORS = [
    83,
    84,
    85,
    86,
    87,
    81,
    75,
    69,
    63,
    57,
    93,
    129,
    165,
    199,
    196,
]


def show(arr):
    low = np.min(arr)
    high = np.max(arr)
    delta = high - low + 0.001  # Make sure we never reach 1.0
    holes = {5, 7, 11, 12}

    def color(x):
        shade = COLORS[int(len(COLORS) * (x - low) / delta)]
        return f"\x1b[48;5;{shade}m{x:.02f}\x1b[0m"

    color_bar = "".join(f"\x1b[48;5;{x}m   \x1b[0m" for x in COLORS)
    out = f"0.0 {color_bar} 1.0\n\n"
    for i in range(4):
        a, b, c = "", "", ""
        for j in range(4):
            left, bottom, right, top = list(arr[i * 4 + j])
            text = "\033[1;31mH\033[0m" if i * 4 + j in holes else " "
            a += f"    {color(top)}     "
            b += f"{color(left)} {text}  {color(right)} "
            c += f"    {color(bottom)}     "
        out += f"{a}\n{b}\n{c}\n\n"
    return out


if __name__ == "__main__":
    print(A)
    print(show(A))
